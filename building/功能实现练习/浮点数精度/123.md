好的，按你的要求分成三段独立代码，每段都加入了 `KeyboardInterrupt` 异常处理：


### 第一段：高精度计算器（decimal库）
```python
from decimal import Decimal, getcontext
from decimal import InvalidOperation
import re

# 设置Decimal的精度（保留28位有效数字）
getcontext().prec = 28

def calculator_precise(expression):
    """基于decimal库的高精度计算器"""
    try:
        expr = expression
        # 匹配数字并替换为Decimal类型
        expr = re.sub(r'(\d+\.?\d*|-?\d+\.?\d*)', r'Decimal("\1")', expr)
        result = eval(expr)
        return f"{expression} = {result}"
    except InvalidOperation as e:
        return f"数值错误：{str(e)}"
    except Exception as e:
        return f"输入错误：{str(e)}"


if __name__ == "__main__":
    print("\n高精度计算器（decimal库）")
    try:  # 捕获强制中断
        while True:
            expr = input("请输入计算式（输入'q'退出）：")
            if expr.lower() == 'q':
                break
            print(calculator_precise(expr))
    except KeyboardInterrupt:
        print("\n程序已安全退出")
```


### 第二段：原始计算器（不处理精度问题）
```python
def calculator_raw(expression):
    """不处理精度问题，直接返回原生计算结果"""
    try:
        result = eval(expression)
        return f"{expression} = {result}"
    except Exception as e:
        return f"输入错误：{str(e)}"


if __name__ == "__main__":
    print("原始计算器（不处理精度问题）")
    try:  # 捕获强制中断
        while True:
            expr = input("请输入计算式（输入'q'退出）：")
            if expr.lower() == 'q':
                break
            print(calculator_raw(expr))
    except KeyboardInterrupt:
        print("\n程序已安全退出")
```


### 第三段：基础计算器（内置运算，简单精度处理）
```python
def calculator_basic(expression):
    """基于Python内置运算的计算器（简单精度处理）"""
    try:
        result = eval(expression)
        # 保留6位小数（处理浮点数显示）
        if isinstance(result, float):
            result = round(result, 6)
        return f"{expression} = {result}"
    except Exception as e:
        return f"输入错误：{str(e)}"


if __name__ == "__main__":
    print("基础计算器（内置运算）")
    try:  # 捕获强制中断
        while True:
            expr = input("请输入计算式（输入'q'退出）：")
            if expr.lower() == 'q':
                break
            print(calculator_basic(expr))
    except KeyboardInterrupt:
        print("\n程序已安全退出")
```


每段代码都是独立可运行的，且在主循环外添加了 `try-except` 捕获 `KeyboardInterrupt`，强制中断时会输出“程序已安全退出”，不再显示错误堆栈。